<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Java records demystified</title>
    <link rel="shortcut icon" href="/assets/icons/favicon.ico" />
    <link rel="stylesheet" href="/css/styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/ir-black.min.css"
    />
  </head>
  <body>
    <div class="flex flex-col lg:flex-row">
      <div
        class="w-screen max-w-screen lg:max-w-xs lg:h-screen bg-red-100 fixed lg:relative"
      >
        <div class="w-full">
          <div class="flex flex-col w-full p-4 lg:p-12">
            <div class="flex flex-row w-full items-center justify-between">
              <div class="lg:mt-3">
                <a href="/">
                  <img
                    class="rounded-full h-8 w-8 lg:h-16 lg:w-16"
                    src="/assets/dp/dp.jpg"
                    alt="author profile picture"
                  />
                </a>
              </div>
              <button id="menu-show-btn" class="lg:hidden h-6 w-6">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 20 20"
                  class=""
                >
                  <path
                    d="M16.4 9H3.6c-.552 0-.6.447-.6 1 0 .553.048 1 .6 1h12.8c.552 0 .6-.447.6-1 0-.553-.048-1-.6-1zm0 4H3.6c-.552 0-.6.447-.6 1 0 .553.048 1 .6 1h12.8c.552 0 .6-.447.6-1 0-.553-.048-1-.6-1zM3.6 7h12.8c.552 0 .6-.447.6-1 0-.553-.048-1-.6-1H3.6c-.552 0-.6.447-.6 1 0 .553.048 1 .6 1z"
                  />
                </svg>
              </button>

              <button id="menu-hide-btn" class="hidden h-6 w-6">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                  <path
                    d="M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"
                  />
                </svg>
              </button>
            </div>
            <div id="menu" class="hidden lg:block">
              <div>
                <h1 class="font-medium text-xl mt-6">
                  Isank
                </h1>
                <p class="font-light mt-1">Just another Software Engineer;</p>
              </div>
              <div>
                <nav class="font-medium mt-6">
                  <ul>
                    <li class="hover:underline">
                      <a href="/">Posts</a>
                    </li>
                  </ul>
                </nav>
              </div>
              <div>
                <ul class="flex mt-6">
                  
                  <li class="list-none mr-2">
                    <a class="inline-block h-8 w-8" href="https://twitter.com/isank">
                      <svg
                        class="fill-current text-gray-900"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                      >
                        <path d="M10 .4C4.698.4.4 4.698.4 10s4.298 9.6 9.6 9.6 9.6-4.298 9.6-9.6S15.302.4 10 .4zm3.905 7.864c.004.082.005.164.005.244 0 2.5-1.901 5.381-5.379 5.381a5.335 5.335 0 0 1-2.898-.85c.147.018.298.025.451.025.886 0 1.701-.301 2.348-.809a1.895 1.895 0 0 1-1.766-1.312 1.9 1.9 0 0 0 .853-.033 1.892 1.892 0 0 1-1.517-1.854v-.023c.255.141.547.227.857.237a1.89 1.89 0 0 1-.585-2.526 5.376 5.376 0 0 0 3.897 1.977 1.891 1.891 0 0 1 3.222-1.725 3.797 3.797 0 0 0 1.2-.459 1.9 1.9 0 0 1-.831 1.047 3.799 3.799 0 0 0 1.086-.299 3.834 3.834 0 0 1-.943.979z"/>
                      </svg>
                    </a>
                  </li>
                  
                  <li class="list-none mr-2">
                    <a class="inline-block h-8 w-8" href="https://github.com/isank">
                      <svg
                        class="fill-current text-gray-900"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                      >
                        <path d="M10.015 9.949h-.03c-1.191 0-2.24-.303-2.861.268a1.57 1.57 0 0 0-.527 1.197c0 1.852 1.483 2.08 3.389 2.08h.029c1.905 0 3.389-.229 3.389-2.08 0-.443-.156-.856-.527-1.197-.622-.571-1.671-.268-2.862-.268zM8.393 12.48c-.363 0-.656-.408-.656-.91s.293-.908.656-.908c.363 0 .657.406.657.908.001.502-.293.91-.657.91zm3.213 0c-.363 0-.657-.408-.657-.91s.294-.908.657-.908c.362 0 .656.406.656.908.001.502-.293.91-.656.91zM10 .4C4.698.4.4 4.698.4 10s4.298 9.6 9.6 9.6 9.6-4.298 9.6-9.6S15.302.4 10 .4zm.876 13.539c-.172 0-.514 0-.876.002-.362-.002-.704-.002-.876-.002-.76 0-3.772-.059-3.772-3.689 0-.834.286-1.445.755-1.955-.074-.184-.078-1.232.32-2.236 0 0 .916.1 2.301 1.051.289-.081.781-.122 1.272-.122s.982.041 1.273.121c1.385-.951 2.301-1.051 2.301-1.051.398 1.004.395 2.053.32 2.236.469.51.755 1.121.755 1.955-.001 3.632-3.013 3.69-3.773 3.69z"/>
                      </svg>
                    </a>
                  </li>
                  
                  <li class="list-none mr-2">
                    <a class="inline-block h-8 w-8" href="https://in.linkedin.com/in/isank">
                      <svg
                        class="fill-current text-gray-900"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                      >
                        <path d="M10 .4C4.698.4.4 4.698.4 10s4.298 9.6 9.6 9.6 9.6-4.298 9.6-9.6S15.302.4 10 .4zM7.65 13.979H5.706V7.723H7.65v6.256zm-.984-7.024c-.614 0-1.011-.435-1.011-.973 0-.549.409-.971 1.036-.971s1.011.422 1.023.971c0 .538-.396.973-1.048.973zm8.084 7.024h-1.944v-3.467c0-.807-.282-1.355-.985-1.355-.537 0-.856.371-.997.728-.052.127-.065.307-.065.486v3.607H8.814v-4.26c0-.781-.025-1.434-.051-1.996h1.689l.089.869h.039c.256-.408.883-1.01 1.932-1.01 1.279 0 2.238.857 2.238 2.699v3.699z"/>
                      </svg>
                    </a>
                  </li>
                  
                  <li class="list-none mr-2">
                    <a class="inline-block h-8 w-8" href="https://www.instagram.com/isank_a">
                      <svg
                        class="fill-current text-gray-900"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                      >
                        <path d="M13.498 6.651a1.656 1.656 0 0 0-.95-.949 2.766 2.766 0 0 0-.928-.172c-.527-.024-.685-.03-2.02-.03s-1.493.006-2.02.03a2.766 2.766 0 0 0-.929.172 1.656 1.656 0 0 0-.949.95 2.766 2.766 0 0 0-.172.928c-.024.527-.03.685-.03 2.02s.006 1.493.03 2.02a2.766 2.766 0 0 0 .172.929 1.656 1.656 0 0 0 .95.949 2.766 2.766 0 0 0 .928.172c.527.024.685.029 2.02.029s1.493-.005 2.02-.03a2.766 2.766 0 0 0 .929-.171 1.656 1.656 0 0 0 .949-.95 2.766 2.766 0 0 0 .172-.928c.024-.527.029-.685.029-2.02s-.005-1.493-.03-2.02a2.766 2.766 0 0 0-.171-.929zM9.6 12.168A2.568 2.568 0 1 1 12.168 9.6 2.568 2.568 0 0 1 9.6 12.168zm2.669-4.637a.6.6 0 1 1 .6-.6.6.6 0 0 1-.6.6z"/><circle cx="9.6" cy="9.6" r="1.667"/><path d="M9.6 0a9.6 9.6 0 1 0 9.6 9.6A9.6 9.6 0 0 0 9.6 0zm4.97 11.661a3.67 3.67 0 0 1-.233 1.214 2.556 2.556 0 0 1-1.462 1.462 3.67 3.67 0 0 1-1.213.233c-.534.024-.704.03-2.062.03s-1.528-.006-2.062-.03a3.67 3.67 0 0 1-1.213-.233 2.556 2.556 0 0 1-1.462-1.462 3.67 3.67 0 0 1-.233-1.213c-.024-.534-.03-.704-.03-2.062s.006-1.528.03-2.062a3.67 3.67 0 0 1 .232-1.213 2.556 2.556 0 0 1 1.463-1.463 3.67 3.67 0 0 1 1.213-.232c.534-.024.704-.03 2.062-.03s1.528.006 2.062.03a3.67 3.67 0 0 1 1.213.232 2.556 2.556 0 0 1 1.462 1.463 3.67 3.67 0 0 1 .233 1.213c.024.534.03.704.03 2.062s-.006 1.528-.03 2.062z"/>
                      </svg>
                    </a>
                  </li>
                  
                  <li class="list-none mr-2">
                    <a class="inline-block h-8 w-8" href="mailto:isankagarwal@gmail.com">
                      <svg
                        class="fill-current text-gray-900"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                      >
                        <path d="M10 .4C4.698.4.4 4.698.4 10s4.298 9.6 9.6 9.6 9.6-4.298 9.6-9.6S15.302.4 10 .4zM6.231 7h7.52c.399 0 .193.512-.024.643-.217.13-3.22 1.947-3.333 2.014s-.257.1-.403.1a.793.793 0 0 1-.402-.1L6.255 7.643C6.038 7.512 5.833 7 6.231 7zM14 12.5c0 .21-.252.5-.444.5H6.444C6.252 13 6 12.71 6 12.5V8.853c0-.092-.002-.211.172-.11l3.417 2.015a.69.69 0 0 0 .402.1.69.69 0 0 0 .403-.1l3.434-2.014c.174-.102.172.018.172.11V12.5z"/>
                      </svg>
                    </a>
                  </li>
                  
                </ul>
              </div>
            </div>
          </div>
          <div class="text-center hidden lg:block">
            <span
              class="text-xs text-gray-500 font-hairline subpixel-antialiased"
            >
              &copy; 2020 Isank Agarwal. All rights reserved.
            </span>
          </div>
        </div>
      </div>
      <div class="w-screen max-w-screen lg:h-screen overflow-y-auto">
        <div
          class="px-4 pb-4 pt-20 lg:p-12  markdown"
        >
          <article class="post-title">
  <header>
    <h1 class="font-bold text-gray-900 text-3xl">
      Java records demystified
    </h1>
    <span class="font-light text-sm text-gray-600">
      Apr 21, 2020 - 
    </span>
    <span class="font-light text-sm text-gray-600">
      Isank
    </span>
  </header>
</article>
<p>Java has always been verbose and almost all of us have accepted the fact and are used to its verbosity. We generally take the help of our super-intelligent IDEs or libraries like <a href="https://projectlombok.org/">lombok</a> to generate most of the boilerplate code.</p>
<p>Still, when it comes down to doing super simple things like creating a data carrier class (which is as dumb as it sounds), a simple DTO or a value object we always feel the need to have something quick and embedded in Java itself.</p>
<h2>Presenting, records</h2>
<p><em>records</em> are a new type declaration in Java. But, before we move ahead let me make it very clear that records are not something that has been introduced to address problems like boilerplate, properties class or annotation-driven code generation, etc. Instead, it has been designed with a more thoughtful goal of representing <em>data as data</em></p>
<blockquote>
<p>Remember, records are still a preview feature and you'll have to use the <code>--enable-preview</code> flag (explained below) when compiling/executing the programs from this post. You will also need <a href="https://jdk.java.net/14/">JDK 14</a>.</p>
</blockquote>
<pre class="hljs"><code>javac --release 14 --<span class="hljs-built_in">enable</span>-preview Example.java
</code></pre>
<pre class="hljs"><code>java --<span class="hljs-built_in">enable</span>-preview Example
</code></pre>
<h2>Create a record</h2>
<p>Here is a record in its simplest form.</p>
<pre class="hljs"><code><span class="hljs-comment">// Point.java</span>
<span class="hljs-function">record <span class="hljs-title">point</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span></span>{};
</code></pre>
<p>Yes, that's it. Yes, it's Java. Yes, pure Java. No, no libraries, annotations or frameworks.</p>
<p>A record has a name (<code>Point</code> in this case), state description which declares the components (<code>(int x, int y)</code>) and an optional body (notice <code>{}</code>).</p>
<p>Now, let's see what Java generates for you after you compile your code.</p>
<pre class="hljs"><code><span class="hljs-comment">// decompiled Point.class</span>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Point</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">java</span>.<span class="hljs-title">lang</span>.<span class="hljs-title">Record</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> x;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> y;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Point</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>{ <span class="hljs-comment">/* compiled code */</span> }

    <span class="hljs-keyword">public</span> java.lang.<span class="hljs-function">String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{ <span class="hljs-comment">/* compiled code */</span> }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hashCode</span><span class="hljs-params">()</span> </span>{ <span class="hljs-comment">/* compiled code */</span> }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(java.lang.Object o)</span> </span>{ <span class="hljs-comment">/* compiled code */</span> }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">x</span><span class="hljs-params">()</span> </span>{ <span class="hljs-comment">/* compiled code */</span> }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">y</span><span class="hljs-params">()</span> </span>{ <span class="hljs-comment">/* compiled code */</span> }
}
</code></pre>
<p>A lot of things are pretty evident from the code above</p>
<ol>
<li>records are implicitly immutable.</li>
<li>a public all args constructor with signature same as the state description</li>
<li>public getters</li>
<li>implementation of hashCode &amp; equals</li>
<li>implementation of toString</li>
</ol>
<p>Superb! right?</p>
<h2>How to use records?</h2>
<p>records enjoy all the benefits of a Java class with some restrictions (which we will see later on). That said, a record can be instantiated with the <code>new</code> keyword and the methods can be accessed like any other object's.</p>
<pre class="hljs"><code><span class="hljs-comment">// Application.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{

        Point point = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>);

        System.out.println(<span class="hljs-string">"point = "</span> + point.toString());
        System.out.println(<span class="hljs-string">"point.x = "</span> + point.x());
        System.out.println(<span class="hljs-string">"point.y = "</span> + point.y());
    }
}

<span class="hljs-comment">// output</span>
point = Point[x=<span class="hljs-number">2</span>, y=<span class="hljs-number">4</span>]
point.x = <span class="hljs-number">2</span>
point.y = <span class="hljs-number">4</span>
</code></pre>
<h2>Equality in records</h2>
<p>As we saw earlier, a record implicitly generates <code>hashCode</code> and <code>equals</code> and if we go by this default implementation, then, two records are equal to each other when they're of the same type and contain the same state. An example will make it more clear</p>
<pre class="hljs"><code><span class="hljs-comment">// Application.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{

        Point point1 = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);

        Point point2 = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);

        System.out.println(<span class="hljs-string">"point1.equals(point2) = "</span> + point1.equals(point2));
    }
}

<span class="hljs-comment">// output</span>
point1.equals(point2) = <span class="hljs-keyword">true</span>
</code></pre>
<p><code>point1</code> and <code>point2</code> are equal to each other for being of the same type (Point) and containing the same states (x = 1 &amp; y = 2)</p>
<h2>Restrictions</h2>
<p>records do have some restrictions as well</p>
<ol>
<li>they cannot extend any other class</li>
</ol>
<pre class="hljs"><code><span class="hljs-function">record <span class="hljs-title">Point</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> extends SomeClass </span>{}; <span class="hljs-comment">// Error - not allowed</span>
</code></pre>
<ol start="2">
<li>they cannot have explicit instance variables other than the private final fields which are the part of components of the state description</li>
</ol>
<pre class="hljs"><code><span class="hljs-function">record <span class="hljs-title">Point</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> extends SomeClass </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> z; <span class="hljs-comment">// Error - not allowed</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> z; <span class="hljs-comment">// Error - not allowed</span>
};
</code></pre>
<h2>Features</h2>
<p>Apart from the restrictions above, records do behave like normal classes</p>
<ol>
<li>they can have static fields, methods, initializers</li>
</ol>
<pre class="hljs"><code><span class="hljs-comment">// Point.java</span>
<span class="hljs-function">record <span class="hljs-title">Point</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>{

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">double</span> PI = <span class="hljs-number">3.14</span>; <span class="hljs-comment">// allowed</span>

    <span class="hljs-comment">// allowed</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getPI</span><span class="hljs-params">()</span> </span>{

        <span class="hljs-keyword">return</span> PI;
    }

    <span class="hljs-comment">// allowed</span>
    <span class="hljs-keyword">static</span> {

        System.out.println(<span class="hljs-string">"Printed in a static initializer"</span>);
    }
};
</code></pre>
<ol start="2">
<li>they can have instance methods</li>
</ol>
<pre class="hljs"><code><span class="hljs-comment">// Point.java</span>
<span class="hljs-function">record <span class="hljs-title">Point</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>{

    <span class="hljs-comment">// allowed</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">add</span><span class="hljs-params">()</span> </span>{

        <span class="hljs-keyword">return</span> x + y;
    }
};
</code></pre>
<ol start="3">
<li>they can have explicit canonical constructors without a formal parameter list. This allows performing validations &amp; normalizations</li>
</ol>
<pre class="hljs"><code><span class="hljs-comment">// Point.java</span>
<span class="hljs-function">record <span class="hljs-title">Point</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>{

    <span class="hljs-comment">// allowed</span>
    <span class="hljs-keyword">public</span> Point {

        <span class="hljs-keyword">if</span> (x &lt; y) {

            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">"x cannot be less than y"</span>);
        }
    }
};
</code></pre>
<ol start="4">
<li>Yes, they can be generic too</li>
</ol>
<pre class="hljs"><code><span class="hljs-comment">// Point.java</span>
record Point&lt;T&gt;(T x, T y) {};

<span class="hljs-comment">// Application.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{

        Point&lt;String&gt; point = <span class="hljs-keyword">new</span> Point&lt;&gt;(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>);
    }
}
</code></pre>
<h2>Final thoughts</h2>
<p><em>records</em> being so less verbose and concise while still enjoying a normal class's features are a great addition to Java. Developers will surely find it beneficial at various places and will be able to move very quickly when representing data in their code.</p>

        </div>
      </div>
    </div>
    <script src="/js/menuToggle.js"></script>
  </body>
</html>
